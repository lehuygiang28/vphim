module.exports = {
    apps: [
        {
            namespace: 'proxy',
            name: 'cloudflared',
            script: 'cloudflared',
            args: 'tunnel --no-autoupdate --metrics localhost:9000 --protocol http2 run',
            instances: 1,
            env: {
                TUNNEL_TOKEN: process.env.CLOUDFLARED_TOKEN || 'giang',
            },
            output: '/dev/stdout',
            error: '/dev/stderr',
            log_date_format: 'YYYY-MM-DD HH:mm:ss',
            autorestart: true,
            exp_backoff_restart_delay: 100,
            restart_delay: 1000,
            max_restarts: 10000,
            min_uptime: '5m',
            kill_timeout: 30000,
            watch: false,
            ignore_watch: ['*'],
            max_memory_restart: '1G',
        },
        {
            namespace: 'cache',
            name: 'redis',
            script: '/usr/bin/redis-server',
            args: [
                '--port',
                process.env.REDIS_PORT || '6379',
                '--requirepass',
                process.env.REDIS_PASSWORD || 'giang',
                '--save',
                '""',
                '--appendonly',
                'no',
                '--maxmemory',
                '2048mb',
                '--maxmemory-policy',
                'noeviction',
            ].join(' '),
            output: '/dev/stdout',
            error: '/dev/stderr',
            log_date_format: 'YYYY-MM-DD HH:mm:ss',
            autorestart: true,
            exp_backoff_restart_delay: 100,
            restart_delay: 1000,
            max_restarts: 10000,
            min_uptime: '5m',
            kill_timeout: 30000,
            watch: false,
            ignore_watch: ['*'],
            max_memory_restart: '2048M',
        },
        {
            namespace: 'apps',
            name: 'vphim-api',
            script: '/usr/src/app/dist/apps/api/main.js',
            instances: 4,
            exec_mode: 'cluster',
            output: '/dev/stdout',
            error: '/dev/stderr',
            log_date_format: 'YYYY-MM-DD HH:mm:ss',
            autorestart: true,
            exp_backoff_restart_delay: 100,
            restart_delay: 1000,
            max_restarts: 10000,
            min_uptime: '5m',
            kill_timeout: 30000,
            watch: false,
            ignore_watch: ['*'],
            max_memory_restart: '2G',
        },
    ],
};
