@startuml Get Single Director Flow

skinparam SequenceMessageAlignment center
skinparam SequenceBoxBackgroundColor white
skinparam SequenceBoxBorderColor black
skinparam NoteBackgroundColor lightyellow
skinparam NoteBorderColor black
skinparam ParticipantBackgroundColor white
skinparam ParticipantBorderColor black

title Get Single Director Flow (GraphQL)

actor Client
participant "GraphQL Server" as GraphQL
participant "Director Resolver" as Resolver
participant "Director Service" as Service
participant "Director Repository" as Repository
database "MongoDB" as DB

Client -> GraphQL : Query director(input: {_id or slug})
activate GraphQL
GraphQL -> Resolver : getDirector(input)
activate Resolver

Resolver -> Service : getDirector({_id, slug})
activate Service

alt _id parameter provided
    Service -> Repository : findOneOrThrow(filterQuery: {_id})
    activate Repository
    
    Repository -> DB : Find director by _id
    activate DB
    DB --> Repository : Return director or null
    deactivate DB
    
    alt director found
        Repository --> Service : Return director
    else director not found
        Repository --> Service : Throw exception
    end
    
    deactivate Repository
else slug parameter provided
    Service -> Repository : findOneOrThrow(filterQuery: {slug})
    activate Repository
    
    Repository -> DB : Find director by slug
    activate DB
    DB --> Repository : Return director or null
    deactivate DB
    
    alt director found
        Repository --> Service : Return director
    else director not found
        Repository --> Service : Throw exception
    end
    
    deactivate Repository
else no parameters provided
    Service --> Resolver : Throw HTTP 422 Exception\n(Unprocessable Entity)
end

alt success
    Service --> Resolver : Return director
    Resolver --> GraphQL : Return DirectorType
    GraphQL --> Client : JSON Response
else error
    Service --> Resolver : Throw exception
    Resolver --> GraphQL : Return error
    GraphQL --> Client : Error Response
end

deactivate Service
deactivate Resolver
deactivate GraphQL

@enduml 